<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Shagun Saree Baran</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="gallery-styles.css">
    <link rel="stylesheet" href="color-variants.css">
    <link rel="stylesheet" href="mobile-nav-fix.css">
    <link rel="stylesheet" href="product-mobile-optimized.css">
    <link rel="stylesheet" href="footer-mobile.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="navbar">
            <div class="nav-brand">
                <a href="index.html" class="logo-link">
                    <div class="logo-container">
                        <span class="logo-icon">S</span>
                        <span class="logo-text">Shagun Saree</span>
                    </div>
                </a>
            </div>

            <div class="nav-actions">
                <a href="cart.html" class="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cartCount">0</span>
                </a>
                <button class="login-btn">Login</button>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="product-main">
        <div class="container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a href="index.html">Home</a> / 
                <a href="collections.html">Collections</a> / 
                <span>Product Details</span>
            </nav>

            <!-- Product Details -->
            <div class="product-details">
                <!-- Product Images -->
                <div class="product-images">
                    <div class="main-image-container">
                        <img src="" alt="" id="mainImage" class="main-image">
                    </div>
                    <div class="thumbnail-images" id="thumbnailImages">
                        <!-- Thumbnails will be loaded dynamically -->
                    </div>
                </div>

                <!-- Product Info -->
                <div class="product-info">
                    <h1 id="productTitle">Product Title</h1>
                    
                    <div class="product-rating">
                        <div class="stars">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                        </div>
                        <span class="rating-text">4.5 out of 5</span>
                        <span class="reviews-count">(128 reviews)</span>
                    </div>

                    <div class="product-price">
                        <span class="current-price" id="currentPrice">₹0</span>
                        <span class="original-price" id="originalPrice">₹0</span>
                        <span class="discount" id="discount">0% OFF</span>
                    </div>

                    <div class="product-description" id="productDescription">
                        Product description will be loaded here...
                    </div>

                    <!-- Color Variants -->
                    <div class="color-variants" id="colorVariants" style="display: none;">
                        <h4>Available Colors</h4>
                        <div class="variant-swatches" id="variantSwatches">
                            <!-- Color variant swatches will be loaded dynamically -->
                        </div>
                    </div>

                    <!-- Color Selection -->
                    <div class="product-options">
                        <div class="option-group">
                            <h4>Color</h4>
                            <div class="color-options" id="colorOptions">
                                <!-- Color options will be loaded dynamically -->
                            </div>
                        </div>

                        <!-- Quantity Selection -->
                        <div class="option-group">
                            <h4>Quantity</h4>
                            <div class="quantity-selector">
                                <button class="qty-btn" id="decreaseQty">-</button>
                                <input type="number" value="1" min="1" max="10" id="quantityInput" class="quantity-input">
                                <button class="qty-btn" id="increaseQty">+</button>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="product-actions">
                        <button class="add-to-cart-btn" id="addToCartBtn">
                            <i class="fas fa-shopping-cart"></i>
                            Add to Cart
                        </button>
                        <button class="buy-now-btn" id="buyNowBtn">
                            <i class="fas fa-bolt"></i>
                            Buy Now
                        </button>
                    </div>

                    <!-- Product Highlights -->
                    <div class="product-highlights">
                        <h4>Product Highlights</h4>
                        <ul id="productHighlights">
                            <!-- Highlights will be loaded dynamically -->
                        </ul>
                    </div>

                    <!-- Delivery Info -->
                    <div class="delivery-info">
                        <div class="delivery-item">
                            <i class="fas fa-truck"></i>
                            <div>
                                <strong>Free Delivery</strong>
                                <p>On orders above ₹999</p>
                            </div>
                        </div>

                        <div class="delivery-item">
                            <i class="fas fa-shield-alt"></i>
                            <div>
                                <strong>Secure Payment</strong>
                                <p>100% secure checkout</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </main>

    <!-- Footer -->
    <footer style="background: #2c3e50; color: white; padding: 40px 0 20px;">
        <div style="max-width: 1200px; margin: 0 auto; padding: 0 20px;">
            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 40px; margin-bottom: 30px;">
                <div>
                    <h3 style="color: #FF6B6B; margin-bottom: 15px; font-size: 1.5rem;">Shagun Saree Baran</h3>
                    <p style="color: #ecf0f1; line-height: 1.6; margin: 0;">Your trusted destination for premium Indian sarees. Quality, tradition, and elegance in every piece.</p>
                </div>
                <div>
                    <h4 style="color: white; margin-bottom: 15px; font-size: 1.2rem;">Quick Links</h4>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <a href="index.html" style="color: #ecf0f1; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#FF6B6B'" onmouseout="this.style.color='#ecf0f1'">Home</a>
                        <a href="collections.html" style="color: #ecf0f1; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#FF6B6B'" onmouseout="this.style.color='#ecf0f1'">Collections</a>
                        <a href="cart.html" style="color: #ecf0f1; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#FF6B6B'" onmouseout="this.style.color='#ecf0f1'">Cart</a>
                        <a href="contact.html" style="color: #ecf0f1; text-decoration: none; transition: color 0.3s;" onmouseover="this.style.color='#FF6B6B'" onmouseout="this.style.color='#ecf0f1'">Contact Us</a>
                    </div>
                </div>
                <div>
                    <h4 style="color: white; margin-bottom: 15px; font-size: 1.2rem;">Contact Info</h4>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div style="color: #ecf0f1;"><i class="fas fa-envelope" style="color: #FF6B6B; margin-right: 8px;"></i>shagunsaree60@gmail.com</div>
                        <div style="color: #ecf0f1;"><i class="fas fa-phone" style="color: #FF6B6B; margin-right: 8px;"></i>+91 9636788945</div>
                        <div style="color: #ecf0f1;"><i class="fas fa-map-marker-alt" style="color: #FF6B6B; margin-right: 8px;"></i>Krishna Colony, Baran, Rajasthan</div>
                    </div>
                </div>
                <div>
                    <h4 style="color: white; margin-bottom: 15px; font-size: 1.2rem;">Follow Us</h4>
                    <div style="display: flex; gap: 15px;">
                        <a href="https://www.instagram.com/shagun_sareebaran?igsh=cjJoZXozejhhZ2Nh" target="_blank" style="color: #ecf0f1; font-size: 1.5rem; transition: color 0.3s;" onmouseover="this.style.color='#e4405f'" onmouseout="this.style.color='#ecf0f1'"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
            </div>
            <div style="border-top: 1px solid #34495e; padding-top: 20px; text-align: center;">
                <p style="color: #bdc3c7; margin: 0;">&copy; 2025 Shagun Saree Baran. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script src="main.js"></script>
    <script src="cart-count-fix.js"></script>
    <script src="stock-system.js"></script>
    <script>
        // Load product details when page loads
        document.addEventListener('DOMContentLoaded', async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            const selectedColor = urlParams.get('color');
            
            if (productId) {
                // Initialize Supabase
                const SUPABASE_URL = 'https://jstvadizuzvwhabtfhfs.supabase.co';
                const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzdHZhZGl6dXp2d2hhYnRmaGZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjI3NjAsImV4cCI6MjA3MjIzODc2MH0.6btNpJfUh6Fd5PfoivIvu-f31Fj5IXl1vxBLsHz5ISw';
                window.supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                
                await loadProductDetails(productId, selectedColor);
            } else {
                window.location.href = 'collections.html';
            }
        });
        
        async function loadProductDetails(productId, selectedColor) {
            try {
                console.log('Loading product with ID:', productId);
                
                // Try Supabase first
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .eq('id', productId)
                    .single();
                
                if (error || !data) {
                    console.log('Supabase error or no data, using fallback:', error);
                    // Use fallback products
                    const fallbackProducts = [
                        {
                            id: '1',
                            name: "Silk Banarasi Saree",
                            price: 15000,
                            originalPrice: 18000,
                            image: "https://via.placeholder.com/500x600/FF6B6B/FFFFFF?text=Silk+Banarasi",
                            images: [
                                "https://via.placeholder.com/500x600/FF6B6B/FFFFFF?text=Silk+Banarasi+1",
                                "https://via.placeholder.com/500x600/FF4444/FFFFFF?text=Silk+Banarasi+2",
                                "https://via.placeholder.com/500x600/FF8888/FFFFFF?text=Silk+Banarasi+3"
                            ],
                            category: "silk",
                            rating: 4.8,
                            description: "Exquisite Banarasi silk saree with intricate zari work. Perfect for weddings and special occasions.",
                            colors: ["Red", "Green", "Blue"],
                            sizes: ["Free Size"],
                            fabric: "Silk",
                            reviews: 156
                        },
                        {
                            id: '2',
                            name: "Cotton Handloom Saree",
                            price: 2500,
                            originalPrice: 3000,
                            image: "https://via.placeholder.com/500x600/4ECDC4/FFFFFF?text=Cotton+Handloom",
                            category: "cotton",
                            rating: 4.5,
                            description: "Comfortable cotton handloom saree for daily wear. Breathable and elegant.",
                            colors: ["White", "Beige", "Pink"],
                            sizes: ["Free Size"],
                            fabric: "Cotton",
                            reviews: 89
                        },
                        {
                            id: '3',
                            name: "Designer Georgette Saree",
                            price: 8000,
                            originalPrice: 10000,
                            image: "https://via.placeholder.com/500x600/45B7D1/FFFFFF?text=Designer+Georgette",
                            category: "designer",
                            rating: 4.7,
                            description: "Elegant designer georgette saree with modern aesthetics and traditional charm.",
                            colors: ["Purple", "Teal", "Maroon"],
                            sizes: ["Free Size"],
                            fabric: "Georgette",
                            reviews: 203
                        }
                    ];
                    
                    const product = fallbackProducts.find(p => p.id === productId);
                    if (!product) {
                        alert('Product not found!');
                        window.location.href = 'collections.html';
                        return;
                    }
                    
                    displayProductDetails(product, selectedColor);
                    setupProductActions(product);
                    return;
                }
                
                const product = {
                    id: data.id,
                    name: data.name,
                    price: data.price,
                    originalPrice: data.originalPrice || data.original_price,
                    image: data.images && data.images.length > 0 ? data.images[0] : null,
                    images: data.images || [],
                    category: data.category,
                    rating: data.rating || 4.5,
                    description: data.description,
                    colors: data.colors || ['Red', 'Blue', 'Green'],
                    color_variants: data.color_variants || [],
                    sizes: data.sizes || ['Free Size'],
                    fabric: data.fabric,
                    reviews: data.reviews || 50
                };
                
                displayProductDetails(product, selectedColor);
                setupProductActions(product);
            } catch (error) {
                console.error('Error loading product:', error);
                alert('Error loading product!');
                window.location.href = 'collections.html';
            }
        }
        
        function displayProductDetails(product, selectedColor) {
            document.getElementById('productTitle').textContent = product.name;
            document.getElementById('currentPrice').textContent = `₹${product.price.toLocaleString()}`;
            document.getElementById('originalPrice').textContent = product.originalPrice ? `₹${product.originalPrice.toLocaleString()}` : '';
            document.getElementById('productDescription').textContent = product.description || 'No description available.';
            
            // Load image gallery
            let imagesToShow = [];
            
            // If a color is selected and color variants exist, use variant images
            if (selectedColor && product.color_variants && product.color_variants.length > 0) {
                const colorVariant = product.color_variants.find(v => v.color === selectedColor);
                if (colorVariant && colorVariant.images && colorVariant.images.length > 0) {
                    imagesToShow = colorVariant.images.map(img => {
                        return img.startsWith('http') ? img : `https://jstvadizuzvwhabtfhfs.supabase.co/storage/v1/object/public/Sarees/${img}`;
                    });
                    // Update product name to include color
                    document.getElementById('productTitle').textContent = `${product.name} - ${selectedColor}`;
                }
            }
            
            // Fallback to main product images if no variant images found
            if (imagesToShow.length === 0) {
                console.log('Product images array:', product.images);
                if (product.images && Array.isArray(product.images) && product.images.length > 0) {
                    imagesToShow = product.images.map(img => {
                        if (!img) return null;
                        return img.startsWith('http') ? img : `https://jstvadizuzvwhabtfhfs.supabase.co/storage/v1/object/public/Sarees/${img}`;
                    }).filter(img => img !== null);
                    console.log('Processed images:', imagesToShow);
                } else if (product.image) {
                    const imageUrl = product.image.startsWith('http') ? product.image : `https://jstvadizuzvwhabtfhfs.supabase.co/storage/v1/object/public/Sarees/${product.image}`;
                    imagesToShow = [imageUrl];
                } else {
                    imagesToShow = [`https://via.placeholder.com/500x600/FF6B6B/FFFFFF?text=${encodeURIComponent(product.name)}`];
                }
            }
            
            // Display image gallery
            displayImageGallery(imagesToShow, product.name);
            
            // Calculate discount
            if (product.originalPrice && product.originalPrice > product.price) {
                const discount = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                document.getElementById('discount').textContent = `${discount}% OFF`;
            }
            
            // Load colors (prioritize color variants if available)
            const colorOptions = document.getElementById('colorOptions');
            let availableColors = [];
            
            if (product.color_variants && product.color_variants.length > 0) {
                availableColors = product.color_variants.map(v => v.color);
            } else if (product.colors && product.colors.length > 0) {
                availableColors = product.colors;
            }
            
            if (availableColors.length > 0) {
                colorOptions.innerHTML = availableColors.map(color => {
                    const isSelected = color === selectedColor ? 'selected' : '';
                    const variant = product.color_variants ? product.color_variants.find(v => v.color === color) : null;
                    const colorCode = variant ? variant.colorCode : getColorCodeFromName(color);
                    const style = colorCode ? `style="background-color: ${colorCode}; color: ${getContrastColor(colorCode)};"` : '';
                    return `<div class="color-option ${isSelected}" data-color="${color}" ${style} onclick="selectColor('${color}')">${color}</div>`;
                }).join('');
            }
            

            
            // Update page title
            document.title = `${product.name} - Shagun Saree Baran`;
        }
        
        function displayImageGallery(images, productName) {
            const mainImage = document.getElementById('mainImage');
            const thumbnailContainer = document.getElementById('thumbnailImages');
            
            // Set main image
            mainImage.src = images[0];
            mainImage.alt = productName;
            
            // Create thumbnails if more than one image
            if (images.length > 1) {
                thumbnailContainer.innerHTML = images.map((img, index) => `
                    <img src="${img}" alt="${productName} ${index + 1}" class="thumbnail" onclick="changeMainImage('${img}')">
                `).join('');
                thumbnailContainer.style.display = 'flex';
            } else {
                thumbnailContainer.style.display = 'none';
            }
        }
        
        function changeMainImage(imageUrl) {
            const mainImage = document.getElementById('mainImage');
            mainImage.src = imageUrl;
            
            // Update active thumbnail
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.classList.remove('active');
                if (thumb.src === imageUrl) {
                    thumb.classList.add('active');
                }
            });
        }
        
        function setupProductActions(product) {
            // Add to Cart button
            document.getElementById('addToCartBtn').addEventListener('click', function() {
                const quantity = parseInt(document.getElementById('quantityInput').value);
                addProductToCart(product, quantity);
            });
            
            // Buy Now button
            document.getElementById('buyNowBtn').addEventListener('click', function() {
                const quantity = parseInt(document.getElementById('quantityInput').value);
                buyNowProduct(product, quantity);
            });
            
            // Quantity controls
            document.getElementById('increaseQty').addEventListener('click', function() {
                const input = document.getElementById('quantityInput');
                input.value = parseInt(input.value) + 1;
            });
            
            document.getElementById('decreaseQty').addEventListener('click', function() {
                const input = document.getElementById('quantityInput');
                if (parseInt(input.value) > 1) {
                    input.value = parseInt(input.value) - 1;
                }
            });
        }
        
        function addProductToCart(product, quantity) {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            const existingItem = cart.find(item => item.id === product.id);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                cart.push({ ...product, quantity });
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            
            // Update cart count
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
            
            // Show notification
            alert(`Added ${quantity} item(s) to cart!`);
        }
        
        function buyNowProduct(product, quantity) {
            // Check if user is logged in
            const userSession = localStorage.getItem('userSession');
            if (!userSession) {
                alert('Please login to buy now.');
                window.location.href = 'auth.html';
                return;
            }
            
            // Store buy now item separately (don't add to cart)
            const buyNowItem = { ...product, quantity };
            localStorage.setItem('buyNowItem', JSON.stringify(buyNowItem));
            
            // Go directly to address page with buy now flag
            window.location.href = 'address.html?buyNow=true';
        }
        
        function selectColor(color) {
            // Update URL with selected color
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            window.location.href = `product.html?id=${productId}&color=${encodeURIComponent(color)}`;
        }
        
        function getColorCodeFromName(colorName) {
            const colorMap = {
                'red': '#FF0000', 'blue': '#0000FF', 'green': '#008000', 'yellow': '#FFFF00',
                'orange': '#FFA500', 'purple': '#800080', 'pink': '#FFC0CB', 'black': '#000000',
                'white': '#FFFFFF', 'gray': '#808080', 'grey': '#808080', 'brown': '#A52A2A',
                'maroon': '#800000', 'navy': '#000080', 'teal': '#008080', 'olive': '#808000',
                'lime': '#00FF00', 'aqua': '#00FFFF', 'silver': '#C0C0C0', 'gold': '#FFD700',
                'beige': '#F5F5DC', 'cream': '#FFFDD0', 'ivory': '#FFFFF0'
            };
            return colorMap[colorName.toLowerCase()] || '#CCCCCC';
        }
        
        function getContrastColor(hexColor) {
            if (!hexColor || hexColor.length < 7) return '#000000';
            // Convert hex to RGB
            const r = parseInt(hexColor.substr(1, 2), 16);
            const g = parseInt(hexColor.substr(3, 2), 16);
            const b = parseInt(hexColor.substr(5, 2), 16);
            
            // Calculate luminance
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            
            // Return black or white based on luminance
            return luminance > 0.5 ? '#000000' : '#FFFFFF';
        }
        
        // Make changeMainImage globally available
        window.changeMainImage = changeMainImage;
    </script>
</body>
</html>

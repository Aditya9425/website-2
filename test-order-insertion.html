<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Order Insertion - Shagun Saree</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #FF6B6B;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-button:hover {
            background: #FF5252;
        }
        .test-result {
            margin: 20px 0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ Order Insertion Test</h1>
        <p>This page tests the order insertion functionality with Supabase.</p>
        
        <div class="test-buttons">
            <button class="test-button" onclick="testSupabaseConnection()">Test Supabase Connection</button>
            <button class="test-button" onclick="setupTestUser()">Setup Test User</button>
            <button class="test-button" onclick="setupTestAddress()">Setup Test Address</button>
            <button class="test-button" onclick="testOrderInsertion()">Test Order Insertion</button>
            <button class="test-button" onclick="clearTestData()">Clear Test Data</button>
        </div>
        
        <div id="testResults"></div>
        
        <div class="test-info">
            <h3>üìã Test Instructions:</h3>
            <ol>
                <li>Click "Test Supabase Connection" to verify database connectivity</li>
                <li>Click "Setup Test User" to create a test user session</li>
                <li>Click "Setup Test Address" to create test delivery address</li>
                <li>Click "Test Order Insertion" to insert a test order</li>
                <li>Check the admin panel to see if the order appears</li>
                <li>Click "Clear Test Data" to clean up</li>
            </ol>
        </div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://jstvadizuzvwhabtfhfs.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzdHZhZGl6dXp2d2hhYnRmaGZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY2NjI3NjAsImV4cCI6MjA3MjIzODc2MH0.6btNpJfUh6Fd5PfoivIvu-f31Fj5IXl1vxBLsHz5ISw';

        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('testResults');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}:</strong> ${message}`;
            resultsDiv.appendChild(resultDiv);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        async function testSupabaseConnection() {
            try {
                showResult('üîÑ Testing Supabase connection...', 'info');
                
                const { data, error } = await supabase
                    .from('products')
                    .select('count')
                    .limit(1);
                
                if (error) {
                    throw error;
                }
                
                showResult('‚úÖ Supabase connection successful!', 'success');
            } catch (error) {
                showResult(`‚ùå Supabase connection failed: ${error.message}`, 'error');
            }
        }

        function setupTestUser() {
            try {
                const testUser = {
                    id: 'test-user-123',
                    email: 'test@example.com',
                    mobile: '9999999999'
                };
                
                localStorage.setItem('userSession', JSON.stringify(testUser));
                showResult('‚úÖ Test user session created', 'success');
            } catch (error) {
                showResult(`‚ùå Error setting up test user: ${error.message}`, 'error');
            }
        }

        function setupTestAddress() {
            try {
                const testAddress = {
                    firstName: 'Test',
                    lastName: 'User',
                    email: 'test@example.com',
                    mobile: '9999999999',
                    addressLine1: '123 Test Street',
                    addressLine2: 'Test Area',
                    city: 'Test City',
                    state: 'Test State',
                    pincode: '123456'
                };
                
                localStorage.setItem('deliveryAddress', JSON.stringify(testAddress));
                showResult('‚úÖ Test delivery address created', 'success');
            } catch (error) {
                showResult(`‚ùå Error setting up test address: ${error.message}`, 'error');
            }
        }

        async function testOrderInsertion() {
            try {
                showResult('üîÑ Testing order insertion...', 'info');
                
                // Check prerequisites
                const userSession = localStorage.getItem('userSession');
                const deliveryAddress = localStorage.getItem('deliveryAddress');
                
                if (!userSession) {
                    throw new Error('No user session found. Please setup test user first.');
                }
                
                if (!deliveryAddress) {
                    throw new Error('No delivery address found. Please setup test address first.');
                }
                
                const user = JSON.parse(userSession);
                const address = JSON.parse(deliveryAddress);
                
                // Create test order
                const testOrder = {
                    user_id: user.id,
                    items: [
                        {
                            id: 'test-product-1',
                            name: 'Test Silk Saree',
                            price: 2500,
                            quantity: 1,
                            image: 'https://via.placeholder.com/300x400/FF6B6B/FFFFFF?text=Test+Saree',
                            category: 'silk'
                        }
                    ],
                    total_amount: 2700, // 2500 + 200 delivery
                    shipping_addr: address,
                    status: 'confirmed',
                    payment_method: 'test',
                    created_at: new Date().toISOString()
                };
                
                showResult('üì¶ Inserting test order into Supabase...', 'info');
                
                // Insert into Supabase
                const { data, error } = await supabase
                    .from('orders')
                    .insert([testOrder])
                    .select()
                    .single();
                
                if (error) {
                    throw error;
                }
                
                showResult(`‚úÖ Test order inserted successfully! Order ID: ${data.id}`, 'success');
                showResult(`üìä Order details: ${JSON.stringify(data, null, 2)}`, 'info');
                
            } catch (error) {
                showResult(`‚ùå Order insertion failed: ${error.message}`, 'error');
                console.error('Full error:', error);
            }
        }

        function clearTestData() {
            try {
                localStorage.removeItem('userSession');
                localStorage.removeItem('deliveryAddress');
                localStorage.removeItem('cart');
                localStorage.removeItem('buyNowItem');
                
                showResult('üßπ Test data cleared from localStorage', 'success');
            } catch (error) {
                showResult(`‚ùå Error clearing test data: ${error.message}`, 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showResult('üöÄ Order insertion test page loaded', 'info');
            showResult('üìù Make sure you have the orders table created in Supabase', 'info');
        });
    </script>
</body>
</html>